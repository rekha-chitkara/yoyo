<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.naver.kus.service.BoardDao">
		<resultMap type="com.naver.kus.entities.Board" id="boardMap">
		<id property="b_seq" column="b_seq"/>
		<id property="b_id" column="b_id"/>
		<id property="b_name" column="b_name"/>
		<id property="b_passowrd" column="b_passowrd"/>
		<id property="b_email" column="b_email"/>
		<id property="b_title" column="b_title"/>
		<id property="b_content" column="b_content"/>
		<id property="b_date" column="b_date"/>
		<id property="b_ip" column="b_ip"/>
		<id property="b_ref" column="b_ref"/>
		<id property="b_step" column="b_step"/>
		<id property="b_hit" column="b_hit"/>
		<id property="b_level" column="b_level"/>
		<id property="b_attach" column="b_attach"/>
		<id property="b_dept" column="b_dept"/>
		</resultMap>
		<select id="boardSelectAll" resultMap="boardMap">
				select*from
				(select rownum numrow, A.* from (select * from board 
				order by b_ref desc, b_step asc)A) where b_dept=#{b_dept}
		</select>
		<select id="boardSelectCon" resultMap="boardMap">
				select*from (select rownum numrow, A.* from 
		(select * from board order by b_ref desc, b_step asc)A) where b_id=#{b_id} and b_dept like 'doctor%'
		</select>
		<select id="doctorNoticeAll" resultMap="boardMap">select*from (select rownum numrow, A.* from 
		(select * from board order by b_ref desc, b_step asc)A) where b_id=#{b_id} and b_dept='5'
		</select> 
		<select id="SelectPageList" resultMap="boardMap">
				select*from
				(select rownum numrow, A.* from (select * from board where ${selectbox} like '%'||#{find}||'%'
				order by b_ref desc, b_step asc)A) where numrow <![CDATA[<=]]>#{endrow} and numrow>#{startrow} 
		</select>
		<insert id="insertBoard" parameterType="hashMap">
				insert into board (b_seq,b_id,b_name,b_email,b_title,b_content,b_date,b_ip,b_ref,b_step,b_hit,b_level,b_dept) 
				values ((select coalesce(max(b_seq)+1,1) from board),
				#{b_id},#{b_name},#{b_email},#{b_title},#{b_content},#{b_date},#{b_ip}
				,(select count(*) from board where b_dept=#{b_dept})+1,#{b_step},#{b_hit},#{b_level},#{b_dept})
		</insert>
		<select id="selectCount" parameterType="hashMap" resultType="int">
			select count(*) from board where ${selectbox} like '%'||#{find}||'%'
		</select>
		<select id="selectCountAll" parameterType="hashMap" resultType="int">
			select count(*) from board 
		</select>
		<select id="selectOne" parameterType="int" resultMap="boardMap">
			select*from board where b_seq=#{b_seq}
		</select>
		<update id="updateBoard" parameterType="hashMap">
			update board set b_title=#{b_title},b_content=#{b_content},b_ip=#{b_ip},b_date=#{b_date} where b_seq=#{b_seq}
		</update>
		<delete id="deleteRow" parameterType="int">
			delete from board where b_seq=#{b_seq}
		</delete>
		<update id="updateHit" parameterType="int">
			update board set b_hit=b_hit+1 where b_seq=#{b_seq}
		</update>
		<insert id="insertReply" parameterType="hashMap">
				insert into board (b_seq,b_id,b_name,b_email,b_title,b_content,b_date,b_ip,b_ref,b_step,b_hit,b_level) 
				values ((select coalesce(max(b_seq)+1,1) from board),
				#{b_id},#{b_name},#{b_email},#{b_title},#{b_content},#{b_date},#{b_ip}
				,#{b_ref},#{b_step},#{b_hit},#{b_level})
		</insert>
</mapper>